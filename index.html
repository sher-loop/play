<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sherlock Playlist</title>
  <link rel="icon" type="image/jpg" href="https://sherloop.rf.gd/pic/sher.jpg">
  <style>
    body {
      background: #000;
      color: #0ff;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      -webkit-font-smoothing:antialiased;
    }

    h1 {
      margin: 20px;
      font-size: 2rem;
      text-shadow: 0 0 20px #0ff;
    }

    .now-playing {
      text-align: center;
      margin-bottom: 10px;
      font-size: 1.1rem;
      color: #0ff;
      text-shadow: 0 0 10px #0ff, 0 0 20px #00f;
    }

    .search-bar {
      width: 90%;
      max-width: 500px;
      padding: 10px;
      margin-bottom: 10px;
      border: none;
      border-radius: 8px;
      outline: none;
      font-size: 1rem;
      text-align: center;
      background: #111;
      color: #0ff;
      box-shadow: 0 0 10px #0ff, 0 0 15px #00f;
    }

    /* Playlist container */
    .song-list {
      width: 90%;
      max-width: 500px;
      height: 400px;
      overflow-y: auto;
      padding: 10px;
      border-radius: 10px;
      background: #111;
      box-shadow: inset 0 0 20px #00f;
      display: block;
    }

    .song {
      padding: 10px;
      margin-bottom: 5px;
      cursor: pointer;
      border-radius: 6px;
      transition: 0.12s;
      user-select: none;
    }
    .song:hover {
      background: #222;
      box-shadow: 0 0 10px #0ff;
    }
    .song.active {
      background: #0ff;
      color: #000;
      font-weight: 700;
      box-shadow: 0 0 15px #0ff, 0 0 25px #00f;
    }

    .player-controls {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-top: 15px;
      width: 90%;
      max-width: 500px;
      justify-content: flex-start;
    }
    .btn {
      padding: 12px 18px;
      border: none;
      border-radius: 50%;
      background: #111;
      color: #0ff;
      font-size: 1.1rem;
      cursor: pointer;
      transition: transform .12s, box-shadow .12s;
      box-shadow: 0 0 10px #0ff;
    }
    .btn:hover {
      transform: scale(1.15);
      box-shadow: 0 0 22px #0ff, 0 0 30px #00f;
    }

    /* Progress bar */
    .progress-container {
      width: 90%;
      max-width: 500px;
      margin-top: 12px;
      display: flex;
      align-items: center;
      gap: 10px;
      color: #0ff;
      font-size: 0.9rem;
    }
    .progress-bar {
      flex: 1;
      height: 8px;
      background: #222;
      border-radius: 5px;
      overflow: hidden;
      cursor: pointer;
      box-shadow: inset 0 0 10px #00f;
    }
    .progress {
      height: 100%;
      width: 0%;
      background: #0ff;
      box-shadow: 0 0 10px #0ff, 0 0 20px #00f;
      transition: width 0.08s linear;
    }

    /* Small volume on right inside controls row */
    .volume-container {
      margin-left: auto;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .volume-slider {
      width: 80px;
      appearance: none;
      height: 6px;
      border-radius: 5px;
      background: #222;
      outline: none;
      cursor: pointer;
      box-shadow: inset 0 0 10px #00f;
    }
    .volume-slider::-webkit-slider-thumb {
      appearance: none;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #0ff;
      cursor: pointer;
      box-shadow: 0 0 10px #0ff, 0 0 20px #00f;
    }
    .volume-slider::-moz-range-thumb {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #0ff;
      cursor: pointer;
      box-shadow: 0 0 10px #0ff, 0 0 20px #00f;
    }

    /* Neon scrollbar - always visible and thicker */
    .song-list::-webkit-scrollbar { width: 14px; }
    .song-list::-webkit-scrollbar-track {
      background: #111;
      border-radius: 12px;
      box-shadow: inset 0 0 10px #00f;
    }
    .song-list::-webkit-scrollbar-thumb {
      background: #0ff;
      border-radius: 12px;
      box-shadow: 0 0 12px #0ff, 0 0 25px #00f;
    }
    .song-list::-webkit-scrollbar-thumb:hover { background: #00f; }

    /* Firefox */
    .song-list { scrollbar-width: thin; scrollbar-color: #0ff #111; }

    /* responsive */
    @media (min-width:900px) {
      h1 { font-size: 2.2rem; }
      .song-list { height: 520px; max-width: 700px; }
      .progress-container, .player-controls { max-width: 700px; width: 90%; }
    }

    /* ‚úÖ Scrollbar Styling */
.song-list {
  width: 90%;
  max-width: 500px;
  height: 400px;
  overflow-y: scroll; /* always visible */
  padding: 10px;
  border-radius: 10px;
  background: #111;
  box-shadow: inset 0 0 20px #00f;
}

/* ‚úÖ Chrome, Edge, Safari */
.song-list::-webkit-scrollbar {
  width: 14px; /* little bigger */
}

.song-list::-webkit-scrollbar-track {
  background: #111;
  border-radius: 10px;
}

.song-list::-webkit-scrollbar-thumb {
  background: #0ff;
  border-radius: 10px;
  box-shadow: 0 0 10px #0ff, 0 0 20px #00f;
}

.song-list::-webkit-scrollbar-thumb:hover {
  background: #00f;
}

/* ‚úÖ Firefox */
.song-list {
  scrollbar-width: thick;   /* bigger */
  scrollbar-color: #0ff #111; /* thumb + track */
}

  </style>
</head>
<body>
  <h1>üéµ Sherlock Playlist</h1>
  <div class="now-playing" id="nowPlaying">Select a song to play</div>

  <input id="search" class="search-bar" placeholder="Search songs..." />

  <!-- Playlist (we will render reversed visually but keep numbering 1..N top-down) -->
  <div class="song-list" id="songList" aria-label="Playlist"></div>

  <div class="player-controls">
    <button id="prev" class="btn" title="Previous">‚èÆ</button>
    <button id="play" class="btn" title="Play/Pause">‚ñ∂Ô∏è</button>
    <button id="next" class="btn" title="Next">‚è≠</button>

    <div class="volume-container" title="Volume">
      <span>üîä</span>
      <input id="volume" class="volume-slider" type="range" min="0" max="1" step="0.01" value="1">
    </div>
  </div>

  <div class="progress-container" aria-hidden="false">
    <span id="currentTime">0:00</span>
    <div class="progress-bar" id="progressBar" title="Seek">
      <div class="progress" id="progress"></div>
    </div>
    <span id="duration">0:00</span>
  </div>

  <audio id="audio" preload="metadata"></audio>

<script>
/* ----------------------
   Clean, bug-fixed player
   ---------------------- */

const audio = document.getElementById('audio');
const songListEl = document.getElementById('songList');
const playBtn = document.getElementById('play');
const prevBtn = document.getElementById('prev');
const nextBtn = document.getElementById('next');
const nowPlayingEl = document.getElementById('nowPlaying');
const progress = document.getElementById('progress');
const progressBar = document.getElementById('progressBar');
const currentTimeEl = document.getElementById('currentTime');
const durationEl = document.getElementById('duration');
const volumeSlider = document.getElementById('volume');
const searchInput = document.getElementById('search');

let songs = [];          // full list from JSON
let filteredSongs = [];  // current filtered subset
let currentIndex = 0;    // index into full songs[] (NOT index into filteredSongs)

/* Load playlist.json */
async function loadSongs(){
  const res = await fetch('https://raw.githubusercontent.com/sher-loop/song/main/List/playlist.json');
  songs = await res.json();
  filteredSongs = songs.slice();
  // default current -> last item (so top of reversed UI shows 1 = last item)
  if (filteredSongs.length) {
    currentIndex = songs.indexOf(filteredSongs[filteredSongs.length - 1]);
  }
  renderSongs();
}
 
/* Render the playlist visually upside-down
   but display numbers 1..N top-down. */
function renderSongs(){
  songListEl.innerHTML = '';
  // Build reversed view: top item corresponds to filteredSongs[filteredSongs.length-1]
  const reversed = filteredSongs.slice().reverse();

  reversed.forEach((song, i) => {
    // i is visual position (0 top). numbering should be i+1 top-to-bottom.
    const div = document.createElement('div');
    const realIndex = songs.indexOf(song); // index in full list
    div.className = 'song' + (realIndex === currentIndex ? ' active' : '');
    div.textContent = `${i + 1}. ${song.title}`;
    div.onclick = () => {
      // when user clicks this displayed row, set currentIndex to that real song index
      currentIndex = realIndex;
      playSong();
    };
    songListEl.appendChild(div);
  });

  // After rendering, ensure active element is visible
  scrollActiveIntoView();
}

/* Scroll the active .song element into view (center) */
function scrollActiveIntoView(){
  const els = songListEl.querySelectorAll('.song');
  for (const el of els){
    if (el.classList.contains('active')){
      // use scrollIntoView with options for smoothness and centering
      el.scrollIntoView({ behavior: 'smooth', block: 'center' });
      break;
    }
  }
}

/* Play currentIndex from full songs[] */
function playSong(){
  const song = songs[currentIndex];
  if (!song) return;
  audio.src = song.url;
  audio.play().catch(()=>{}); // ignore play() errors
  playBtn.textContent = '‚è∏';
  nowPlayingEl.textContent = '‚ñ∂Ô∏è ' + song.title;
  renderSongs(); // update active highlight
  updateMediaSessionMetadata(song);
}

/* Pause */
function pauseSong(){
  audio.pause();
  playBtn.textContent = '‚ñ∂Ô∏è';
}

/* Update active highlight (helper used by other code) */
function updateActiveHighlight(){
  // re-render uses songs.indexOf to set active, so just call renderSongs
  renderSongs();
}

/* next / prev operate on full songs[] */
function nextSong(){
  if (!songs.length) return;
  currentIndex = (currentIndex + 1) % songs.length;
  playSong();
}
function prevSong(){
  if (!songs.length) return;
  currentIndex = (currentIndex - 1 + songs.length) % songs.length;
  playSong();
}

/* Attach button handlers */
playBtn.addEventListener('click', () => {
  if (audio.paused) playSong(); else pauseSong();
});
nextBtn.addEventListener('click', nextSong);
prevBtn.addEventListener('click', prevSong);

/* Progress bar updates */
audio.addEventListener('timeupdate', () => {
  const d = audio.duration || 0;
  const percent = d ? (audio.currentTime / d) * 100 : 0;
  progress.style.width = percent + '%';
  currentTimeEl.textContent = formatTime(audio.currentTime);
  durationEl.textContent = formatTime(d);
});
progressBar.addEventListener('click', (e) => {
  const rect = progressBar.getBoundingClientRect();
  const clickX = e.clientX - rect.left;
  const ratio = Math.max(0, Math.min(1, clickX / rect.width));
  if (!isNaN(audio.duration)) audio.currentTime = ratio * audio.duration;
});
audio.addEventListener('ended', () => { nextSong(); });

/* Volume */
volumeSlider.addEventListener('input', (e) => {
  audio.volume = parseFloat(e.target.value);
});

/* Search: update filteredSongs and render reversed view.
   After search, make top item (visual 1) become selected by setting currentIndex
   to the real index of filteredSongs[last] (so top displays as 1). */
searchInput.addEventListener('input', (e) => {
  const q = (e.target.value || '').toLowerCase();
  filteredSongs = songs.filter(s => s.title.toLowerCase().includes(q));
  // if there are results, set currentIndex to the full-list index of the last item in filteredSongs
  if (filteredSongs.length) {
    const topSong = filteredSongs[filteredSongs.length - 1]; // this will appear as number 1 in UI
    currentIndex = songs.indexOf(topSong);
  }
  renderSongs();
});

/* Format time helper */
function formatTime(sec){
  if (!sec || isNaN(sec) || sec <= 0) return '0:00';
  const m = Math.floor(sec/60);
  const s = Math.floor(sec%60).toString().padStart(2,'0');
  return `${m}:${s}`;
}

/* Media Session API so headphone buttons work */
function updateMediaSessionMetadata(song){
  if (!("mediaSession" in navigator) || !song) return;
  try {
    navigator.mediaSession.metadata = new MediaMetadata({
      title: song.title,
      artist: song.artist || "Unknown",
      album: "Sherlock Playlist",
      artwork: [
        { src: "https://sherloop.rf.gd/pic/sher.jpg", sizes: "512x512", type: "image/png" }
      ]
    });
  } catch (err) { /* ignore if not supported */ }
}
if ("mediaSession" in navigator) {
  navigator.mediaSession.setActionHandler('play', () => { playSong(); });
  navigator.mediaSession.setActionHandler('pause', () => { pauseSong(); });
  navigator.mediaSession.setActionHandler('previoustrack', () => { prevSong(); });
  navigator.mediaSession.setActionHandler('nexttrack', () => { nextSong(); });
}

/* initialize */
loadSongs();
  function renderSongs() {
  songListEl.innerHTML = "";

  // üîΩ Reverse only for display
  const reversed = [...filteredSongs].reverse();

  reversed.forEach((song, i) => {
    const div = document.createElement("div");
    // find the original index of this song in songs[]
    const realIndex = songs.indexOf(song);

    // mark active song correctly
    div.className = "song" + (realIndex === currentIndex ? " active" : "");

    // ‚úÖ Display numbers top-down (1,2,3...)
    div.textContent = (i + 1) + ". " + song.title;

    div.onclick = () => {
      currentIndex = realIndex; // keep correct order in songs[]
      playSong();
    };

    songListEl.appendChild(div);
  });
}

</script>
</body>
</html>
